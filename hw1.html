<html>
<head>hw1</head>

<body bgcolor=black>
<center><canvas id=canvas width=800 height=800></canvas>
<script src=webgl.js></script>
<script>

function Scene() {

this.vertexShader = `#version 300 es
in  vec3 aPos;
out vec3 vPos;
void main() {
   gl_Position = vec4(aPos, 1.);
   vPos = aPos;
}`;

this.fragmentShader = `#version 300 es
precision highp float;
uniform float uTime;
in  vec3 vPos;
out vec4 fragColor;

void main() {
   fragColor = vec4(0.);

   vec3 ambient = vec3(.5);
   float zMax = -1000.;

   for (int i = 0 ; i < 500 ; i++) {
      float fi = float(i);
      vec3 color = vec3(.5 + .5 * sin(fi),
                        .5 + .5 * sin(4.*fi),
                        .5 + .5 * sin(5.*fi));
      float vx = vPos.x;
      float vy = vPos.y;
      vx += .2 * sin(1. * uTime);
      vy += .1 * sin(.1 + 5. * uTime);
      float x = 8. * vx + 4. * tan(.8 * fi + .6 * uTime);
      float y = 8. * vy + 4. * tan(.3 * fi + .6 * uTime);
      float z = 0.;

      float rr = 1.1 - max(x*x, y*y);
      // float rr = 1.5 - x*x - y*y;
      z += rr;

      if (rr > 0. && z > zMax) {
         zMax = z;
         float z = sqrt(rr);
         float D1 = dot(vec3(x,y,z),vec3(1.));
         float D2 = dot(vec3(x,y,z),vec3(1.));
	 D1 = .1 * max(0., D1 * abs(D1));
	 D2 = .1 * max(0., D2 * abs(D2));
         vec3 diffuse = D1 * vec3(.1) +
                        D2 * vec3(.1) ;
         fragColor = vec4(sqrt(color * (ambient - z + diffuse)), 1.);
      }
   }
}`;

let startTime = Date.now() / 1000;

this.update = () => {
   setUniform('1f', 'uTime', Date.now() / 1000 - startTime);
}

} 

gl_start(canvas, new Scene());
</script>

</body> 
</html>
